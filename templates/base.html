<!DOCTYPE html>
<html lang="uz" class="h-full">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{% block title %}EduBase{% endblock %}</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            background: 'hsl(var(--background))',
            foreground: 'hsl(var(--foreground))',
            muted: 'hsl(var(--muted))',
            'muted-foreground': 'hsl(var(--muted-foreground))',
            border: 'hsl(var(--border))',
            accent: 'hsl(var(--accent))',
            'accent-foreground': 'hsl(var(--accent-foreground))',
            primary: {
              DEFAULT: 'hsl(var(--primary))',
              foreground: 'hsl(var(--primary-foreground))',
            },
            secondary: {
              DEFAULT: 'hsl(var(--secondary))',
              foreground: 'hsl(var(--secondary-foreground))',
            },
            destructive: {
              DEFAULT: 'hsl(var(--destructive))',
              foreground: 'hsl(var(--destructive-foreground))',
            },
          },
          fontFamily: {
            'sans': ['Inter', 'system-ui', 'sans-serif']
          },
          borderRadius: {
            lg: 'var(--radius)',
            md: 'calc(var(--radius) - 2px)',
            sm: 'calc(var(--radius) - 4px)',
          }
        }
      }
    }
  </script>

  <style>
    :root {
      --background: 0 0% 100%;
      --foreground: 0 0% 3.9%;
      --muted: 0 0% 96.1%;
      --muted-foreground: 0 0% 45.1%;
      --border: 0 0% 89.8%;
      --accent: 0 0% 96.1%;
      --accent-foreground: 0 0% 9%;
      --primary: 0 0% 9%;
      --primary-foreground: 0 0% 98%;
      --secondary: 0 0% 96.1%;
      --secondary-foreground: 0 0% 9%;
      --destructive: 0 84.2% 60.2%;
      --destructive-foreground: 0 0% 98%;
      --radius: 0.5rem;
    }

    .dark {
      --background: 0 0% 3.9%;
      --foreground: 0 0% 98%;
      --muted: 0 0% 14.9%;
      --muted-foreground: 0 0% 63.9%;
      --border: 0 0% 14.9%;
      --accent: 0 0% 14.9%;
      --accent-foreground: 0 0% 98%;
      --primary: 0 0% 98%;
      --primary-foreground: 0 0% 9%;
      --secondary: 0 0% 14.9%;
      --secondary-foreground: 0 0% 98%;
      --destructive: 0 62.8% 30.6%;
      --destructive-foreground: 0 0% 98%;
    }

    * {
      border-color: hsl(var(--border));
    }

    body {
      font-family: 'Inter', system-ui, sans-serif;
      background-color: hsl(var(--background));
      color: hsl(var(--foreground));
      transition: background-color 0.3s, color 0.3s;
    }

    /* Loading Animation */
    .loader-pulse {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      display: block;
      position: relative;
      box-sizing: border-box;
    }

    .loader-pulse::before,
    .loader-pulse::after {
      content: '';
      box-sizing: border-box;
      width: 100%;
      height: 100%;
      border-radius: 50%;
      background: currentColor;
      position: absolute;
      left: 0;
      top: 0;
      animation: pulse-animation-dual 1.8s ease-in-out infinite;
      opacity: 0.7;
    }

    .loader-pulse::after {
      animation-delay: -0.9s;
    }

    @keyframes pulse-animation-dual {
      0%, 100% {
        transform: scale(0);
        opacity: 1;
      }
      50% {
        transform: scale(1);
        opacity: 0;
      }
    }

    /* Sidebar transitions */
    .sidebar-transition {
      transition: transform 0.2s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .sidebar-hidden {
      transform: translateX(-100%);
    }

    /* Tooltip styling */
    .tooltip {
      position: absolute;
      left: 100%;
      top: 50%;
      transform: translateY(-50%);
      margin-left: 0.75rem;
      padding: 0.5rem 0.75rem;
      background: hsl(var(--primary));
      color: hsl(var(--primary-foreground));
      border-radius: 6px;
      font-size: 12px;
      font-weight: 500;
      white-space: nowrap;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.15s ease;
      z-index: 50;
    }

    .group:hover .tooltip {
      opacity: 1;
    }

    /* Page content animation */
    .page-content {
      opacity: 0;
      transform: translateY(10px);
      animation: fadeInUp 0.3s ease forwards;
    }

    @keyframes fadeInUp {
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Loading overlay */
    .loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: hsl(var(--background) / 0.95);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.2s ease, visibility 0.2s ease;
    }

    .loading-overlay.show {
      opacity: 1;
      visibility: visible;
    }

    /* Spinner */
    .spinner {
      width: 24px;
      height: 24px;
      border: 2px solid hsl(var(--border));
      border-top: 2px solid hsl(var(--primary));
      border-radius: 50%;
      animation: spin 0.6s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Layout system */
    .layout-container {
      display: flex;
      height: calc(100vh - 64px);
      position: relative;
    }

    .sidebar-wrapper {
      flex-shrink: 0;
      width: 240px;
      transition: width 0.2s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .sidebar-wrapper.hidden {
      width: 0;
    }

    .main-content-wrapper {
      flex: 1;
      min-width: 0;
      overflow: hidden;
    }

    .main-content {
      height: 100%;
      overflow-y: auto;
    }

    /* Mobile responsive */
    @media (max-width: 767px) {
      .sidebar-wrapper {
        position: absolute;
        top: 0;
        left: 0;
        height: 100%;
        z-index: 20;
        width: 240px !important;
      }

      .sidebar-wrapper.hidden {
        transform: translateX(-100%);
      }

      .main-content-wrapper {
        width: 100%;
      }
    }

    /* Sidebar overlay for mobile */
    .sidebar-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: hsl(0 0% 0% / 0.5);
      z-index: 19;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s ease, visibility 0.3s ease;
    }

    .sidebar-overlay.show {
      opacity: 1;
      visibility: visible;
    }

    /* Card hover effects */
    .card-hover {
      transition: all 0.2s ease;
    }

    .card-hover:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 25px -5px hsl(var(--foreground) / 0.1);
    }

    /* Button animations */
    .btn-animate {
      transition: all 0.2s ease;
    }

    .btn-animate:active {
      transform: scale(0.98);
    }

    /* Focus states */
    .focus-ring:focus {
      outline: none;
      box-shadow: 0 0 0 2px hsl(var(--background)), 0 0 0 4px hsl(var(--primary));
    }
  </style>
</head>

<body class="bg-background text-foreground h-full antialiased">
  <!-- Loading Overlay -->
  <div id="loadingOverlay" class="loading-overlay">
    <div class="flex flex-col items-center space-y-3">
      <div class="spinner"></div>
      <p class="text-sm text-muted-foreground">Yuklanmoqda...</p>
    </div>
  </div>

  <!-- Mobile Sidebar Overlay -->
  <div id="sidebarOverlay" class="sidebar-overlay md:hidden"></div>

  <!-- Navigation -->
  <nav class="fixed top-0 inset-x-0 h-16 bg-background/95 backdrop-blur border-b border-border z-30 flex items-center justify-between px-4 sm:px-6">
    <div class="flex items-center space-x-3">
      <button id="sidebarToggle" class="inline-flex items-center justify-center h-9 w-9 rounded-md text-muted-foreground hover:bg-accent hover:text-foreground transition-colors focus-ring">
        <i class="fas fa-bars text-sm"></i>
      </button>
      <a href="{% url 'accounts:dashboard' %}" class="font-semibold text-xl text-foreground">EduBase</a>
    </div>

    <div class="flex items-center space-x-2">
      <button id="themeToggle" class="inline-flex items-center justify-center h-9 w-9 rounded-md text-muted-foreground hover:bg-accent hover:text-foreground transition-colors focus-ring">
        <i class="fas fa-moon hidden dark:block text-sm"></i>
        <i class="fas fa-sun block dark:hidden text-sm"></i>
      </button>

      {% if user.is_authenticated %}
      <div class="relative">
        <button id="userBtn" class="flex items-center space-x-2 p-1.5 rounded-md hover:bg-accent transition-colors focus-ring">
          <div class="h-8 w-8 rounded-full bg-accent text-accent-foreground flex items-center justify-center text-sm font-medium">
            {{ user.first_name|first|upper }}{{ user.last_name|first|upper }}
          </div>
        </button>

        <div id="userMenu" class="hidden absolute right-0 mt-2 w-48 bg-background border border-border rounded-md shadow-lg py-1 z-50">
          <div class="px-4 py-3 border-b border-border">
            <p class="text-sm font-medium text-foreground">{{ user.get_full_name }}</p>
            <p class="text-xs text-muted-foreground">{{ user.email }}</p>
          </div>
          <a href="#" class="block px-4 py-2 text-sm text-foreground hover:bg-accent transition-colors">Profil</a>
          <a href="{% url 'accounts:logout' %}" class="block px-4 py-2 text-sm text-foreground hover:bg-accent transition-colors">Chiqish</a>
        </div>
      </div>
      {% endif %}
    </div>
  </nav>

  <div class="flex pt-16 h-full">
    <div class="layout-container w-full">
      {% if user.is_authenticated %}
      <!-- Sidebar -->
      <div id="sidebarWrapper" class="sidebar-wrapper">
        <aside id="sidebar" class="sidebar-transition bg-background border-r border-border w-full h-full" data-collapsed="false">
          <nav class="flex-1 p-4 space-y-1">
            {% with request.resolver_match.url_name as url_name %}

            {% if user.profile.role == 'mentor' %}
            <a href="{% url 'accounts:mentor_dashboard' %}" class="group relative flex items-center px-3 py-2.5 rounded-md text-sm font-medium transition-all duration-200 {% if url_name == 'mentor_dashboard' %}bg-accent text-foreground{% else %}text-muted-foreground hover:bg-accent hover:text-foreground{% endif %}">
              <i class="fas fa-home w-5 text-center"></i>
              <span class="ml-3">Bosh sahifa</span>
              <span class="tooltip">Bosh sahifa</span>
            </a>
            <a href="{% url 'attempts:pending_reviews' %}" class="group relative flex items-center px-3 py-2.5 rounded-md text-sm font-medium transition-all duration-200 {% if url_name == 'pending_reviews' %}bg-accent text-foreground{% else %}text-muted-foreground hover:bg-accent hover:text-foreground{% endif %}">
              <i class="fas fa-tasks w-5 text-center"></i>
              <span class="ml-3">Baholash</span>
              <span class="tooltip">Baholash</span>
            </a>
            <a href="{% url 'mentor_groups' %}" class="group relative flex items-center px-3 py-2.5 rounded-md text-sm font-medium transition-all duration-200 {% if url_name == 'mentor_groups' %}bg-accent text-foreground{% else %}text-muted-foreground hover:bg-accent hover:text-foreground{% endif %}">
              <i class="fas fa-users w-5 text-center"></i>
              <span class="ml-3">Guruhlarim</span>
              <span class="tooltip">Guruhlarim</span>
            </a>
            <a href="{% url 'attempts:mentor_stats' %}" class="group relative flex items-center px-3 py-2.5 rounded-md text-sm font-medium transition-all duration-200 {% if url_name == 'mentor_stats' %}bg-accent text-foreground{% else %}text-muted-foreground hover:bg-accent hover:text-foreground{% endif %}">
              <i class="fas fa-chart-bar w-5 text-center"></i>
              <span class="ml-3">Statistika</span>
              <span class="tooltip">Statistika</span>
            </a>

            {% elif user.profile.role == 'student' %}
            <a href="{% url 'accounts:student_dashboard' %}" class="group relative flex items-center px-3 py-2.5 rounded-md text-sm font-medium transition-all duration-200 {% if url_name == 'student_dashboard' %}bg-accent text-foreground{% else %}text-muted-foreground hover:bg-accent hover:text-foreground{% endif %}">
              <i class="fas fa-home w-5 text-center"></i>
              <span class="ml-3">Bosh sahifa</span>
              <span class="tooltip">Bosh sahifa</span>
            </a>
            <a href="{% url 'exam_list' %}" class="group relative flex items-center px-3 py-2.5 rounded-md text-sm font-medium transition-all duration-200 {% if url_name == 'exam_list' %}bg-accent text-foreground{% else %}text-muted-foreground hover:bg-accent hover:text-foreground{% endif %}">
              <i class="fas fa-book w-5 text-center"></i>
              <span class="ml-3">Testlar</span>
              <span class="tooltip">Testlar</span>
            </a>
            <a href="{% url 'attempts:my_attempts' %}" class="group relative flex items-center px-3 py-2.5 rounded-md text-sm font-medium transition-all duration-200 {% if url_name == 'my_attempts' %}bg-accent text-foreground{% else %}text-muted-foreground hover:bg-accent hover:text-foreground{% endif %}">
              <i class="fas fa-chart-bar w-5 text-center"></i>
              <span class="ml-3">Statistika</span>
              <span class="tooltip">Statistika</span>
            </a>
            <a href="{% url 'student_group' %}" class="group relative flex items-center px-3 py-2.5 rounded-md text-sm font-medium transition-all duration-200 {% if url_name == 'student_group' %}bg-accent text-foreground{% else %}text-muted-foreground hover:bg-accent hover:text-foreground{% endif %}">
              <i class="fas fa-users w-5 text-center"></i>
              <span class="ml-3">Guruhim</span>
              <span class="tooltip">Guruhim</span>
            </a>
            {% endif %}

            {% endwith %}
          </nav>
        </aside>
      </div>
      {% endif %}

      <!-- Main Content -->
      <div class="main-content-wrapper">
        <main class="main-content">
          <div class="page-content h-full overflow-y-auto p-6 bg-muted/30">
            <div class="max-w-7xl mx-auto">
              {% block content %}
              <!-- Welcome Section -->
              <div class="mb-8">
                <h1 class="text-3xl font-bold text-foreground">Xush kelibsiz, {{ user.first_name }}</h1>
                <p class="text-muted-foreground mt-2">Bugun nima qilmoqchisiz?</p>
              </div>

              <!-- Stats Grid -->
              <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <div class="bg-background border border-border rounded-lg p-6 card-hover">
                  <div class="flex items-center justify-between">
                    <div>
                      <p class="text-sm font-medium text-muted-foreground">Umumiy ball</p>
                      <p class="text-2xl font-bold text-foreground mt-1">7.5</p>
                    </div>
                    <div class="h-12 w-12 rounded-full bg-blue-100 dark:bg-blue-900/20 flex items-center justify-center">
                      <i class="fas fa-star text-blue-600 dark:text-blue-400"></i>
                    </div>
                  </div>
                  <p class="text-xs text-muted-foreground mt-3">O'tgan oyga nisbatan +0.5</p>
                </div>

                <div class="bg-background border border-border rounded-lg p-6 card-hover">
                  <div class="flex items-center justify-between">
                    <div>
                      <p class="text-sm font-medium text-muted-foreground">Bajarilgan testlar</p>
                      <p class="text-2xl font-bold text-foreground mt-1">24</p>
                    </div>
                    <div class="h-12 w-12 rounded-full bg-green-100 dark:bg-green-900/20 flex items-center justify-center">
                      <i class="fas fa-check-circle text-green-600 dark:text-green-400"></i>
                    </div>
                  </div>
                  <p class="text-xs text-muted-foreground mt-3">Oxirgi 30 kun ichida</p>
                </div>

                <div class="bg-background border border-border rounded-lg p-6 card-hover">
                  <div class="flex items-center justify-between">
                    <div>
                      <p class="text-sm font-medium text-muted-foreground">Keyingi test</p>
                      <p class="text-2xl font-bold text-foreground mt-1">3 kun</p>
                    </div>
                    <div class="h-12 w-12 rounded-full bg-orange-100 dark:bg-orange-900/20 flex items-center justify-center">
                      <i class="fas fa-calendar text-orange-600 dark:text-orange-400"></i>
                    </div>
                  </div>
                  <p class="text-xs text-muted-foreground mt-3">15-dekabr, 10:00</p>
                </div>

                <div class="bg-background border border-border rounded-lg p-6 card-hover">
                  <div class="flex items-center justify-between">
                    <div>
                      <p class="text-sm font-medium text-muted-foreground">Progress</p>
                      <p class="text-2xl font-bold text-foreground mt-1">68%</p>
                    </div>
                    <div class="h-12 w-12 rounded-full bg-purple-100 dark:bg-purple-900/20 flex items-center justify-center">
                      <i class="fas fa-chart-line text-purple-600 dark:text-purple-400"></i>
                    </div>
                  </div>
                  <p class="text-xs text-muted-foreground mt-3">Maqsadingizga yaqinlashdingiz</p>
                </div>
              </div>

              <!-- Main Content Area -->
              <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <!-- Left Column -->
                <div class="lg:col-span-2 space-y-8">
                  <!-- Recent Activity -->
                  <div class="bg-background border border-border rounded-lg p-6">
                    <div class="flex items-center justify-between mb-6">
                      <h2 class="text-xl font-semibold text-foreground">So'nggi faoliyat</h2>
                      <a href="#" class="text-sm text-primary hover:underline">Barchasini ko'rish</a>
                    </div>
                    <div class="space-y-4">
                      <div class="flex items-start space-x-3">
                        <div class="h-8 w-8 rounded-full bg-green-100 dark:bg-green-900/20 flex items-center justify-center mt-1">
                          <i class="fas fa-check text-green-600 dark:text-green-400 text-xs"></i>
                        </div>
                        <div>
                          <p class="text-sm font-medium text-foreground">Reading test topshirildi</p>
                          <p class="text-xs text-muted-foreground">2 kun oldin • Ball: 7.0</p>
                        </div>
                      </div>
                      <div class="flex items-start space-x-3">
                        <div class="h-8 w-8 rounded-full bg-blue-100 dark:bg-blue-900/20 flex items-center justify-center mt-1">
                          <i class="fas fa-book text-blue-600 dark:text-blue-400 text-xs"></i>
                        </div>
                        <div>
                          <p class="text-sm font-medium text-foreground">Yangi dars qo'shildi</p>
                          <p class="text-xs text-muted-foreground">3 kun oldin • Writing</p>
                        </div>
                      </div>
                      <div class="flex items-start space-x-3">
                        <div class="h-8 w-8 rounded-full bg-purple-100 dark:bg-purple-900/20 flex items-center justify-center mt-1">
                          <i class="fas fa-chart-line text-purple-600 dark:text-purple-400 text-xs"></i>
                        </div>
                        <div>
                          <p class="text-sm font-medium text-foreground">Progress yangilandi</p>
                          <p class="text-xs text-muted-foreground">5 kun oldin • +5% o'sish</p>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Quick Actions -->
                  <div class="bg-background border border-border rounded-lg p-6">
                    <h2 class="text-xl font-semibold text-foreground mb-6">Tezkor amallar</h2>
                    <div class="grid grid-cols-2 gap-4">
                      <a href="{% url 'exam_list' %}" class="flex flex-col items-center justify-center p-4 border border-border rounded-lg hover:bg-accent transition-colors card-hover">
                        <i class="fas fa-play-circle text-2xl text-primary mb-2"></i>
                        <span class="text-sm font-medium text-foreground">Test boshlash</span>
                      </a>
                      <a href="{% url 'attempts:my_attempts' %}" class="flex flex-col items-center justify-center p-4 border border-border rounded-lg hover:bg-accent transition-colors card-hover">
                        <i class="fas fa-chart-bar text-2xl text-primary mb-2"></i>
                        <span class="text-sm font-medium text-foreground">Statistikani ko'rish</span>
                      </a>
                      <a href="#" class="flex flex-col items-center justify-center p-4 border border-border rounded-lg hover:bg-accent transition-colors card-hover">
                        <i class="fas fa-book text-2xl text-primary mb-2"></i>
                        <span class="text-sm font-medium text-foreground">Darsliklar</span>
                      </a>
                      <a href="{% url 'student_group' %}" class="flex flex-col items-center justify-center p-4 border border-border rounded-lg hover:bg-accent transition-colors card-hover">
                        <i class="fas fa-users text-2xl text-primary mb-2"></i>
                        <span class="text-sm font-medium text-foreground">Guruhim</span>
                      </a>
                    </div>
                  </div>
                </div>

                <!-- Right Column -->
                <div class="space-y-8">
                  <!-- Upcoming Tests -->
                  <div class="bg-background border border-border rounded-lg p-6">
                    <h2 class="text-xl font-semibold text-foreground mb-6">Yaqinlashayotgan testlar</h2>
                    <div class="space-y-4">
                      <div class="p-3 border border-border rounded-lg">
                        <div class="flex justify-between items-start mb-2">
                          <span class="text-sm font-medium text-foreground">Reading Mock Test</span>
                          <span class="text-xs px-2 py-1 bg-blue-100 dark:bg-blue-900/20 text-blue-700 dark:text-blue-300 rounded-full">Yaqinda</span>
                        </div>
                        <p class="text-xs text-muted-foreground">15-dekabr, 10:00</p>
                        <p class="text-xs text-muted-foreground mt-1">60 daqiqa</p>
                      </div>
                      <div class="p-3 border border-border rounded-lg">
                        <div class="flex justify-between items-start mb-2">
                          <span class="text-sm font-medium text-foreground">Listening Practice</span>
                          <span class="text-xs px-2 py-1 bg-green-100 dark:bg-green-900/20 text-green-700 dark:text-green-300 rounded-full">Rejalashtirilgan</span>
                        </div>
                        <p class="text-xs text-muted-foreground">18-dekabr, 14:30</p>
                        <p class="text-xs text-muted-foreground mt-1">40 daqiqa</p>
                      </div>
                    </div>
                  </div>

                  <!-- Progress -->
                  <div class="bg-background border border-border rounded-lg p-6">
                    <h2 class="text-xl font-semibold text-foreground mb-6">Umumiy progress</h2>
                    <div class="space-y-4">
                      <div>
                        <div class="flex justify-between text-sm mb-1">
                          <span class="text-foreground">Reading</span>
                          <span class="text-muted-foreground">75%</span>
                        </div>
                        <div class="w-full bg-muted rounded-full h-2">
                          <div class="bg-blue-600 h-2 rounded-full" style="width: 75%"></div>
                        </div>
                      </div>
                      <div>
                        <div class="flex justify-between text-sm mb-1">
                          <span class="text-foreground">Writing</span>
                          <span class="text-muted-foreground">60%</span>
                        </div>
                        <div class="w-full bg-muted rounded-full h-2">
                          <div class="bg-green-600 h-2 rounded-full" style="width: 60%"></div>
                        </div>
                      </div>
                      <div>
                        <div class="flex justify-between text-sm mb-1">
                          <span class="text-foreground">Listening</span>
                          <span class="text-muted-foreground">80%</span>
                        </div>
                        <div class="w-full bg-muted rounded-full h-2">
                          <div class="bg-purple-600 h-2 rounded-full" style="width: 80%"></div>
                        </div>
                      </div>
                      <div>
                        <div class="flex justify-between text-sm mb-1">
                          <span class="text-foreground">Speaking</span>
                          <span class="text-muted-foreground">55%</span>
                        </div>
                        <div class="w-full bg-muted rounded-full h-2">
                          <div class="bg-orange-600 h-2 rounded-full" style="width: 55%"></div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              {% endblock %}
            </div>
          </div>
        </main>
      </div>
    </div>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      // Theme Management
      const themeToggle = document.getElementById("themeToggle");
      const docElement = document.documentElement;

      const applyTheme = (theme) => {
        if (theme === 'dark') {
          docElement.classList.add('dark');
          docElement.style.colorScheme = 'dark';
        } else {
          docElement.classList.remove('dark');
          docElement.style.colorScheme = 'light';
        }
      };

      const savedTheme = localStorage.getItem('theme');
      const systemPrefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
      const initialTheme = savedTheme || (systemPrefersDark ? 'dark' : 'light');
      applyTheme(initialTheme);

      if (themeToggle) {
        themeToggle.onclick = () => {
          const isDarkMode = docElement.classList.contains("dark");
          const newTheme = isDarkMode ? 'light' : 'dark';
          localStorage.setItem("theme", newTheme);
          applyTheme(newTheme);
        };
      }

      // Loading Management
      const loadingOverlay = document.getElementById("loadingOverlay");
      
      const showLoader = () => {
        if (loadingOverlay) loadingOverlay.classList.add('show');
      };

      const hideLoader = () => {
        if (loadingOverlay) loadingOverlay.classList.remove('show');
      };

      window.addEventListener('load', hideLoader);

      // User Menu
      const userBtn = document.getElementById("userBtn");
      const userMenu = document.getElementById("userMenu");

      if (userBtn && userMenu) {
        userBtn.addEventListener("click", (event) => {
          event.stopPropagation();
          userMenu.classList.toggle("hidden");
        });

        document.addEventListener("click", (e) => {
          if (!userMenu.classList.contains("hidden") && !userMenu.contains(e.target) && !userBtn.contains(e.target)) {
            userMenu.classList.add("hidden");
          }
        });
      }

      // Sidebar Management
      const sidebar = document.getElementById("sidebar");
      const sidebarWrapper = document.getElementById("sidebarWrapper");
      const sidebarToggle = document.getElementById("sidebarToggle");
      const sidebarOverlay = document.getElementById("sidebarOverlay");

      const setSidebarState = (isHidden) => {
        localStorage.setItem("sidebarHidden", isHidden);

        if (sidebar && sidebarWrapper) {
          sidebar.dataset.collapsed = isHidden;
          const isMobile = window.innerWidth < 768;

          if (isHidden) {
            sidebar.classList.add("sidebar-hidden");
            sidebarWrapper.classList.add("hidden");
            if (sidebarOverlay) sidebarOverlay.classList.remove("show");
          } else {
            sidebar.classList.remove("sidebar-hidden");
            sidebarWrapper.classList.remove("hidden");
            if (isMobile && sidebarOverlay) sidebarOverlay.classList.add("show");
          }
        }
      };

      if (sidebar && sidebarToggle && sidebarWrapper) {
        sidebarToggle.addEventListener("click", () => {
          const isCurrentlyHidden = sidebar.classList.contains("sidebar-hidden");
          setSidebarState(!isCurrentlyHidden);
        });

        if (sidebarOverlay) {
          sidebarOverlay.addEventListener("click", () => {
            setSidebarState(true);
          });
        }

        // Auto-close sidebar on mobile after clicking a link
        const sidebarLinks = sidebar.querySelectorAll('a[href]');
        sidebarLinks.forEach(link => {
          link.addEventListener('click', () => {
            if (window.innerWidth < 768) {
              setTimeout(() => setSidebarState(true), 100);
            }
          });
        });

        // Initialize sidebar state
        const savedSidebarState = localStorage.getItem("sidebarHidden");
        const isMobile = window.innerWidth < 768;
        const initialSidebarState = savedSidebarState !== null ? 
          savedSidebarState === "true" : isMobile;
        
        setSidebarState(initialSidebarState);

        // Handle window resize
        window.addEventListener('resize', () => {
          const isMobileNow = window.innerWidth < 768;
          const isCurrentlyHidden = sidebar.classList.contains("sidebar-hidden");

          if (isMobileNow && !isCurrentlyHidden && sidebarOverlay) {
            sidebarOverlay.classList.add("show");
          } else if (!isMobileNow && sidebarOverlay) {
            sidebarOverlay.classList.remove("show");
          }
        });
      }
    });
  </script>
</body>
</html>